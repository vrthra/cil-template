ifndef ARCHOS
  ARCHOS = @ARCHOS@
endif

ifndef BUILD_TUT11
  BUILD_TUT11 = @BUILD_TUT11@
endif

ifndef BUILD_TUT15
	BUILD_TUT15 = @BUILD_TUT15@
endif

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
pkglibdir = $(libdir)/ciltut

all: Makefile
	make -f Makefile

Makefile: CMakeLists.txt src/CMakeLists.txt
	cmake . -DBUILD_TUT11=$(BUILD_TUT11) -DBUILD_TUT15=$(BUILD_TUT15)

clean:
	make clean
	rm -f *~
	rm -rf `find . -name Makefile`
	rm -rf `find . -name CMakeFiles`
	rm -rf `find . -name CMakeCache.txt`
	rm -rf `find . -name cmake_install.cmake`
	rm -rf `find . -name \*.cmi`
	rm -rf `find . -name \*.cmo`

distclean: clean

INSTALL = /usr/bin/install -c
INSTALL_DATA = ${INSTALL} -m 644
INSTALL_PROGRAM = ${INSTALL}

ifeq ($(ARCHOS),x86_DARWIN)
  SOEXT=dylib
else
  SOEXT=so
endif

INSTALL_LIBS = src/libciltut.a src/libciltut.$(SOEXT)

install: $(INSTALL_FILES)
	$(INSTALL_DATA) $(INSTALL_LIBS) $(DESTDIR)$(pkglibdir)/lib
        
Makefile.dummy: ../config.status Makefile.dummy.in
	@echo "Rebuilding the Makefile"
	(cd ..;./config.status)

